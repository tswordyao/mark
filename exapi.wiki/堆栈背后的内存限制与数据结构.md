<p>每个线程都必须分配一个栈.

<p>每个线程都需要有一块地址, 当线程让出CPU所有权时, 保存cpu各个寄存器的值，好在线程重新拥有cpu的时候恢复运行状态.

<p>栈是系统分配的,连续的,小的.
<p>堆是程序分配的,链式的,大的.

<p>因为每个线程都要一个栈,所以大不了。而且栈的地址空间必须连续---这就限制了很难动态分配利用空间。
<p>因为堆的数据是链式的比较灵活,可以公用,比较大.

<p>线程是进程的一个实体，是CPU调度和分派的基本单位，它是比进程更小的能独立运行的基本单位.线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和<b>栈</b>)，但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源.

<p>堆(heap)的分配与栈有所不同，一般是一个进程有一个C运行时堆，这个堆为本进程中所有线程共享，windows进程还有所谓进程默认堆，用户也可以创建自己的堆。 
用操作系统术语，线程切换的时候实际上切换的是一个可以称之为线程控制块的结构（TCB?）,里面保存所有将来用于恢复线程环境必须的信息，包括所有必须保存的寄存器集，线程的状态等。

<p>堆：　是大家共有的空间，分全局堆和局部堆。全局堆就是所有没有分配的空间，局部堆就是用户分配的空间。堆在操作系统对进程初始化的时候分配，运行过程中也可以向系统要额外的堆，但是记得用完了要还给操作系统，要不然就是内存泄漏。


<p>栈：是个线程独有的，保存其运行状态和局部自动变量的。栈在线程开始的时候初始化，每个线程的栈互相独立，因此，栈是　thread safe的。操作系统在切换线程的时候会自动的切换栈，就是切换　ＳＳ／ＥＳＰ寄存器。栈空间不需要在高级语言里面显式的分配和释放。

* 进程就是程序的一次执行

== 进程是为了在CPU上实现多道编程而发明的一个概念 ==

---

```
进程创建线程，每个线程可以共享进程的地址空间；但同时线程需要保留一些自己私有的数据。
一个进程创建的多个线程：每个都拥有自己私有的Stack，但共享一个Heap。 这样做的原因：

（1）stack is for local/method variables；  heap is for instance/class variable

（2）Stack常常用来存放 函数的参数，函数中使用的自动变量，存放过程活动记录；如果多个线程共享一个Stack会非常的凌乱，不方便使用

（3）使用共享Heap的目的是为了高效的数据共享


线程间的数据交换有两种方式：

（1）共享内存方式shared memory（共享堆）：最大的优势是快速
（2）消息传递方式message passing（不需要共享堆）：优势在于安全
--------------------- 
原文：https://blog.csdn.net/yyf_it/article/details/49924157 
```


