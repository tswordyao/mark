# 关于小程序调试

## 小程序模拟器和真机
小程序模拟器和小程序真机环境有区别. 比如不支持element.append
- 小程序模拟调试控制台, (通过模拟界面右键开启), 能够看到webview中的dom和使用console
- 小程序真机调试控制台, console是只能看小程序wxml的元素, 无法看dom的

```
另外小程序真机的脚本缓存非常严重. 在小程序开发工具上, 根本无法清除. 这是手机端微信缓存的. 
比如webview加载了一个a.html, a.html中有src=b.js的脚本, a.html和b.js都通过Charles代理到本地文件上, a.html在模拟器和真机都即改生效, a.js在真机无论如何重发都体现不了改动.

后来发现Charles中根本没有发出请求, 连304都没走.最后更改html中引用脚本的hash, 如改为: src=a.js?newhash123才强制更新了.
```

weinre还是比较强大的, 有些脚本函数, 可以直接在其console执行, 在Element中可以看到dom, 并且点击对应的真机上的元素会有高亮, 类似chrome控制台.

结论, Charles, weinre, 小程序真机调试, 模拟器调试, 浏览器预先调试一个都不能少.

- 小程序真机发布, 偶尔webview加载url没有出来, 一片空白, 需要多试几次. 先关真机调试控制台, 再关手机上小程序, 再重来.

- 真机调试会临时打包小程序上传, 如果看webview, 可以直接在手机上再次进入develop版小程序, 不用重启扫码也能进入(指定时间内有效);

- 直接在手机上再次进入develop版小程序, 可能会发现webview保持在上次打开状态, 如果希望刷新, 也不需要重启真机调试, 而是先点下小程序其他版本如test版, 关闭, 再进入develop版即可重新载入,webview得到刷新.


## 包的小坑

“....寻找 npm 包的过程和 npm 的实现类似，从依赖 npm 包的文件所在目录开始逐层往外找，直到找到可用的 npm 包或是小程序根目录为止.....”

小程序的npm构建实际就是一个拷贝的工作（分为小程序npm包和普通npm包）。上面是小程序文档中的原理描述。

实际上它和npm的查找机制有一点不同，或者说缺失的就是，npm会往上查找到全局目录 (程序可以在环境变量中读到),  用户可以用 npm root命令查看自己的全局包位置。 

开发过或电脑上有很多项目的同学会发现自己的node_modules很大，很多项目的npm包是重复的，像我往往就会把一些项目对其小版本号不依赖的又高频的包放到全局目录去。

然而，小程序的【 npm构建】是找不到的。应该是小程序的开发者没有模拟全npm的步骤，实现最后一步全局目录的包查找。

所以小程序引用的npm包必须在本项目目录，不能-g